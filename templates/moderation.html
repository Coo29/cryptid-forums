<!DOCTYPE html>
<html>
<!-- header start -->
    <head>
        <title>
            Moderation Panel
        </title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
<!-- header end -->

<!-- back button start -->
    <a href="{{ url_for('index') }}">
        <button>
            Back to main page
        </button>
    </a>
<!-- back button end -->

<!-- header start -->
    <br><br>

    <h1>Moderation Panel</h1>
<!-- header end -->
 
{% block content %}
<!-- post view start -->
    {% for post in posts %}
        <!-- post start -->
            <div class="post-link" data-href="{{ url_for('view_post', post_id=post.id) }}">
                <div class="post" data-href="{{ url_for('view_post', post_id=post.id) }}">
                    <!-- post header start -->
                        <div class="post-header">
                            <img src="{{ post.user.avatar_url }}" alt="Avatar" style="width:40px; height:40px; border-radius:50%; vertical-align:middle; margin-right:10px;">
                            <strong>
                                {{ post.user.username }}
                            </strong>
                        </div>

                        <small>
                            {{ post.timestamp.strftime('%y-%m-%d %H:%M:%S') }}
                        </small>
                    <!-- post header end -->

                    <!-- post content start -->
                        <div class="full_post_content">
                            {{ post.content| safe | format_post_content }}
                        </div>
                        {% if post.images %}
                            {% for image in post.images %}
                                <img src="{{ url_for('static', filename='uploads/images/' ~ image.filename) }}" style="max-width: 200px;">
                            {% endfor %}
                        {% endif %}
                        
                        <p>
                            <form action="{{ url_for('toggle_like', post_id=post.id) }}" method="POST" style="display:inline;">
                                <button type="submit">
                                    {{ post.likes.count() }} âœ“
                                </button>
                            </form>
                        </p>

                        {% if post.attachments %}
                            <div class="attachments">
                                <p>
                                    <strong>
                                        Attached file(s)
                                    </strong>
                                </p>
                                <ul>
                                    {% for attachment in post.attachments %}
                                        <li>
                                            <a class="file" href="{{ url_for('uploaded_file_file', filename=attachment.filename) }}" download>
                                                {{ attachment.original_filename }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        </div>
                    <!-- post content end -->
                </div>
            </div>
        <!-- post end -->

        <!-- comments start -->
            <div class="post">
                <h3>Comments</h3>
                    {% for comment in post.comments %}

                        <strong>
                            {{ comment.user.username }}
                        </strong>
                        -
                        <small>
                            {{ comment.timestamp.strftime('%y-%m-%d %H:%M') }}
                        </small>
                        <p>
                            {{ comment.content }}
                        </p>
                        <hr>
                    {% endfor %}
            </div>
        <!-- comments end -->
<!-- post view end -->

<!-- mod actions start -->
    <form action="{{ url_for('restore_post', post_id=post.id) }}" method="post" style="display: inline;">
        <button type="submit">Restore Post</button>
    </form>
        
    <form action="{{ url_for('permanent_delete_post', post_id=post.id) }}" method="post" style="display: inline;">
        <button type="submit">Permanently Delete Post</button>
    </form>
<!-- mod actions end -->

        <hr>

<!-- no posts start -->
    {% else %}
        <p>No deleted posts to moderate.</p>
    {% endfor %}
<!-- no posts end -->
{% endblock %}

<!-- script loading start -->
    <script src="{{ url_for('static', filename='js/highlight.js') }}"></script>
<!-- script loading end -->
</html>